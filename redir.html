<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Redirigiendo...</title>
</head>
<body>
  <p>Aguarde un momento, le estamos redirigiendo...</p>
  <script type="module">
    const SUPABASE_URL = "https://rpeavohqsnlhdnxahzhx.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwZWF2b2hxc25saGRueGFoemh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMDEyNjAsImV4cCI6MjA3MTg3NzI2MH0.6I3jOy3AArAqadJypBWlwqP1hQ7RWsqr0HhNazGNYMY";

    // Obtener el código desde la URL (último segmento)
    const pathParts = window.location.pathname.split("/");
    const code = pathParts[pathParts.length - 1];

    // Consultar Supabase
    const response = await fetch(`${SUPABASE_URL}/rest/v1/urls?select=target&short=eq.${code}`, {
      headers: {
        apikey: SUPABASE_KEY
      }
    });

    const data = await response.json();

    if (data.length > 0) {
      // Redirigir a la URL larga
      window.location.href = data[0].target;
    } else {
      document.body.innerHTML = "<h2>⚠️ Enlace no encontrado</h2>";
    }
  </script>
</body>
</html>
